<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Portfolio — Annick Bouvattier</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700;800&display=swap" rel="stylesheet">

  <link rel="stylesheet" href="styles.css">
</head>

<body class="portfolio">
  <div class="page">
    <div class="container">

      <!-- HEADER -->
      <header class="top">
        <a class="brand" href="index.html">ANNICK&nbsp;BOUVATTIER</a>
        <nav class="top__nav">
          <a class="nav__link" href="index.html">Accueil</a>
          <a class="nav__link is-active" href="portfolio.html">Portfolio</a>
          <a class="nav__link" href="galeries.html">Galeries</a>
          <a class="nav__link" href="expositions.html">Expositions</a>
          <a class="nav__link" href="apropos.html">À propos</a>
          <a class="nav__link" href="presse.html">Presse</a>
          <a class="nav__link" href="contact.html">Contact</a>
        </nav>
      </header>

      <!-- CHIPS -->
      <div class="filterChips" id="chips"></div>

      <!-- FILTRES -->
      <section class="filterBar">
        <input id="q" class="pillInput" type="search" placeholder="Rechercher une œuvre…" />

        <div class="dd" data-key="year">
          <button class="pillBtn">Année <span class="pillCount" data-count="year"></span> ▾</button>
          <div class="ddPanel" data-panel="year"></div>
        </div>

        <div class="dd" data-key="technique">
          <button class="pillBtn">Technique <span class="pillCount" data-count="technique"></span> ▾</button>
          <div class="ddPanel" data-panel="technique"></div>
        </div>

        <div class="dd" data-key="size">
          <button class="pillBtn">Format <span class="pillCount" data-count="size"></span> ▾</button>
          <div class="ddPanel" data-panel="size"></div>
        </div>

        <div class="dd" data-key="status">
          <button class="pillBtn">Disponible <span class="pillCount" data-count="status"></span> ▾</button>
          <div class="ddPanel" data-panel="status"></div>
        </div>

        <button id="reset" class="pillBtn pillBtn--ghost">Tout effacer</button>
      </section>

      <!-- TITRE -->
      <div class="metaRow">
        <h1 class="title">Portfolio</h1>
        <div class="count" id="count"></div>
      </div>

      <!-- GRILLE -->
      <section class="masonry" id="masonry"></section>

    </div>
  </div>

  <!-- MODAL -->
  <dialog id="modal">
    <div class="modal">
      <div class="modal__media">
        <img id="modalImg" class="modal__img">
        <button id="modalClose" class="modal__closeBtn">×</button>
      </div>
      <div class="modal__info">
        <h2 id="modalTitle" class="modal__h"></h2>
        <p id="modalMeta" class="modal__meta"></p>
      </div>
    </div>
  </dialog>

<script>
/* ================= CONFIG ================= */

const SHEET_CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vSmK-RAKlpq_VMnhd78eWdWeMTnCkU3_-411IzeTyzO9j0zbJdkkhzfxlRDZpqzKixpoUgTtAAI_Auw/pub?output=csv";
const IMG_BASE = "images";

/* ================= HELPERS ================= */

function buildImagePath(jpg){
  let p = String(jpg || "").trim();
  p = p.replace(/^images\//i, "");
  p = p.replace(/^\/+/, "");
  return encodeURI(`${IMG_BASE}/${p}`);
}

function parseCSV(text){
  return text.split("\n").map(r => r.split(",").map(c => c.trim()));
}

function normalize(s){
  return String(s||"").toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"");
}

/* ================= DOM ================= */

const masonry = document.getElementById("masonry");
const count = document.getElementById("count");
const q = document.getElementById("q");
const resetBtn = document.getElementById("reset");

const modal = document.getElementById("modal");
const modalImg = document.getElementById("modalImg");
const modalTitle = document.getElementById("modalTitle");
const modalMeta = document.getElementById("modalMeta");
const modalClose = document.getElementById("modalClose");

let artworks = [];
let filters = { q:"", year:new Set(), technique:new Set(), size:new Set(), status:new Set() };

/* ================= LOAD ================= */

async function load(){
  const res = await fetch(SHEET_CSV_URL);
  const csv = await res.text();
  const rows = parseCSV(csv);
  const headers = rows.shift().map(normalize);

  const col = n => headers.indexOf(normalize(n));

  artworks = rows.map(r => {
    const jpg = r[col("jpg")];
    return {
      title: r[col("nom")],
      year: r[col("annee")],
      technique: r[col("technique")],
      size: r[col("format")] ? r[col("format")]+" cm" : "",
      status: normalize(r[col("disponible")]) === "vendue" ? "vendue" : "disponible",
      image: jpg ? buildImagePath(jpg) : ""
    };
  }).filter(a => a.title && a.image);

  render();
}

/* ================= RENDER ================= */

function render(){
  const list = artworks.filter(a =>
    (!filters.q || a.title.toLowerCase().includes(filters.q)) &&
    (!filters.year.size || filters.year.has(a.year)) &&
    (!filters.technique.size || filters.technique.has(a.technique)) &&
    (!filters.size.size || filters.size.has(a.size)) &&
    (!filters.status.size || filters.status.has(a.status))
  );

  masonry.innerHTML = "";
  list.forEach(a=>{
    const el = document.createElement("article");
    el.className = "piece";
    el.innerHTML = `
      <div class="imgWrap"><img src="${a.image}"></div>
      <div class="cap">
        <p class="capTitle">${a.title}</p>
        <p class="capMeta">${a.technique} · ${a.size} · ${a.year}</p>
        <span class="badge ${a.status}">${a.status}</span>
      </div>
    `;
    el.onclick = ()=>openModal(a);
    masonry.appendChild(el);
  });

  count.textContent = list.length + " œuvre" + (list.length>1?"s":"");
}

/* ================= MODAL ================= */

function openModal(a){
  modalImg.src = a.image;
  modalTitle.textContent = a.title;
  modalMeta.textContent = `${a.technique} · ${a.size} · ${a.year}`;
  modal.showModal();
}
modalClose.onclick = ()=>modal.close();

/* ================= EVENTS ================= */

q.oninput = ()=>{ filters.q = q.value.toLowerCase(); render(); };
resetBtn.onclick = ()=>{
  filters = { q:"", year:new Set(), technique:new Set(), size:new Set(), status:new Set() };
  q.value="";
  render();
};

/* ================= INIT ================= */

load();
</script>

</body>
</html>
