<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Galeries — Annick Bouvattier</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700;800&display=swap" rel="stylesheet">

  <!-- Leaflet -->
  <link rel="stylesheet"
        href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
        integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
        crossorigin="">
  <link rel="stylesheet" href="styles.css">
</head>

<body class="galeries">
  <div class="page">
    <div class="container">

      <header class="top">
        <a class="brand" href="index.html">ANNICK&nbsp;BOUVATTIER</a>

        <nav class="top__nav" aria-label="Navigation principale">
          <a class="nav__link" href="index.html">Accueil</a>
          <a class="nav__link" href="portfolio.html">Portfolio</a>
          <a class="nav__link is-active" href="galeries.html">Galeries</a>
          <a class="nav__link" href="expositions.html">Expositions</a>
          <a class="nav__link" href="informations.html">Informations</a>
          <a class="nav__link" href="apropos.html">À propos</a>
          <a class="nav__link" href="presse.html">Presse</a>
        </nav>
      </header>

      <div class="galHeadRow">
        <h1 class="galTitle">Galeries</h1>
        <div class="galMeta" id="meta"></div>
      </div>

      <!-- ✅ UNE SEULE CARTE (map + liste dedans) -->
      <section class="galCard" aria-label="Carte et liste des galeries">
        <div class="galCard__map">
          <div id="map"></div>
        </div>

        <aside class="galCard__side" aria-label="Liste des galeries">
          <div class="galPanelTitle">Rechercher</div>

          <div class="galSearchRow">
            <input id="q" class="galInput" type="search" placeholder="Nom, ville, pays…" />
            <button class="galBtn" id="reset" type="button">Reset</button>
          </div>

          <div class="galPanelTitle">Galeries</div>
          <div class="galList" id="list"></div>
        </aside>
      </section>

    </div>
  </div>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
          integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
          crossorigin=""></script>

  <script>
    // ✅ Mets ici tes galeries (lat/lng)
    const galleries = [
      {
        name: "Galerie Rue Toulouse (French Art Network)",
        city: "Laguna Beach",
        country: "USA",
        phone: "(949) 549-4546",
        address: "390 S. Coast Hwy, Laguna Beach, CA 92651",
        website: "https://www.frenchart.net",
        lat: 33.5427,
        lng: -117.7831
      },
      {
        name: "Galerie Page",
        city: "Biarritz",
        country: "France",
        phone: "05 59 24 97 52",
        address: "37 Rue Mazagran, 64200 Biarritz",
        website: "https://www.galeriepage-biarritz.com",
        lat: 43.4832,
        lng: -1.5586
      },
      {
        name: "Artclub Gallery",
        city: "Lyon",
        country: "France",
        phone: "+33 (0)4 78 37 47 37",
        address: "22 Place Bellecour, 69002 Lyon",
        website: "https://www.artclub.fr",
        lat: 45.7579,
        lng: 4.8320
      },
      {
        name: "Artclub Gallery",
        city: "Paris",
        country: "France",
        phone: "+33 (0)1 47 03 42 20",
        address: "172 Rue de Rivoli, 75001 Paris",
        website: "https://www.artclub.fr",
        lat: 48.8619,
        lng: 2.3341
      },
      {
        name: "French Art Network — New Orleans",
        city: "New Orleans",
        country: "USA",
        phone: "(504) 581-5881",
        address: "509 Rue Royale, New Orleans, LA 70130",
        website: "https://www.frenchart.net",
        lat: 29.9574,
        lng: -90.0620
      },
      {
        name: "French Art Network — Carmel-by-the-Sea",
        city: "Carmel-by-the-Sea",
        country: "USA",
        phone [...]
        website: "https://www.frenchart.net",
        lat: 36.5552,
        lng: -121.9233
      }
    ];

    const els = {
      meta: document.getElementById("meta"),
      q: document.getElementById("q"),
      reset: document.getElementById("reset"),
      list: document.getElementById("list"),
    };

    function escapeHtml(s){
      return String(s ?? "")
        .replaceAll("&","&amp;")
        .replaceAll("<","&lt;")
        .replaceAll(">","&gt;")
        .replaceAll('"',"&quot;")
        .replaceAll("'","&#039;");
    }

    // MAP INIT
    const map = L.map("map", { scrollWheelZoom: true });
    L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
      maxZoom: 18,
      attribution: "&copy; OpenStreetMap"
    }).addTo(map);

    const markers = [];
    const group = L.featureGroup().addTo(map);

    function makePopup(g){
      const mapsUrl = `https://www.google.com/maps/dir/?api=1&destination=${g.lat},${g.lng}`;
      const site = g.website
        ? `<a class="galPopupBtn" href="${g.website}" target="_blank" rel="noopener noreferrer">Site</a>`
        : "";
      return `
        <div>
          <p class="galPopupTitle">${escapeHtml(g.name)}</p>
          <p class="galPopupMeta">${escapeHtml(g.address)}<br>${escapeHtml(g.city)} · ${escapeHtml(g.country)}</p>
          <div class="galPopupActions">
            <a class="galPopupBtn" href="${mapsUrl}" target="_blank" rel="noopener noreferrer">Itinéraire</a>
            ${site}
          </div>
        </div>
      `;
    }

    function addMarkers(list){
      group.clearLayers();
      markers.length = 0;

      list.forEach((g, idx)=>{
        const m = L.marker([g.lat, g.lng]).addTo(group);
        m.bindPopup(makePopup(g));
        markers.push(m);
      });

      if(list.length){
        map.fitBounds(group.getBounds().pad(0.18));
      }else{
        map.setView([20,0], 2);
      }
    }

    function renderList(list){
      els.list.innerHTML = "";
      list.forEach((g, idx)=>{
        const div = document.createElement("div");
        div.className = "galItem";
        div.innerHTML = `
          <p class="galName">${escapeHtml(g.name)}</p>
          <p class="galSub">
            ${escapeHtml(g.city)} · ${escapeHtml(g.country)}<br>
            ${escapeHtml(g.address)}<br>
            ${g.phone ? escapeHtml(g.phone) + "<br>" : ""}
            ${g.website ? `<a class="galLink" href="${g.website}" target="_blank" rel="noopener noreferrer">site</a>` : ""}
            <span> · </span>
            <a class="galLink" href="https://www.google.com/maps/dir/?api=1&destination=${g.lat},${g.lng}" target="_blank" rel="noopener noreferrer">itinéraire</a>
          </p>
        `;

        div.addEventListener("click", ()=>{
          [...els.list.querySelectorAll(".galItem")].forEach(x=>x.classList.remove("is-active"));
          div.classList.add("is-active");

          const m = markers[idx];
          if(m){
            map.setView(m.getLatLng(), Math.max(map.getZoom(), 6), { animate:true });
            m.openPopup();
          }
        });

        els.list.appendChild(div);
      });
    }

    function apply(){
      const q = (els.q.value || "").trim().toLowerCase();
      const filtered = galleries.filter(g=>{
        const hay = `${g.name} ${g.city} ${g.country} ${g.address}`.toLowerCase();
        return !q || hay.includes(q);
      });

      els.meta.textContent = `${filtered.length} galerie${filtered.length>1 ? "s" : ""}`;

      renderList(filtered);
      addMarkers(filtered);
    }

    els.q.addEventListener("input", apply);
    els.reset.addEventListener("click", ()=>{
      els.q.value = "";
      apply();
    });

    apply();
  </script>
</body>
</html>

