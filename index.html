<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ANNICK BOUVATTIER</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500&display=swap" rel="stylesheet">

  <link rel="stylesheet" href="styles.css" />

  <style>
    body.home{
      background-image:none !important;
      background:#02253A !important;
      overflow:hidden;
    }

    .page{min-height:100vh;display:flex;flex-direction:column;}
    .container{flex:1;display:flex;flex-direction:column;position:relative;z-index:3;}

    .galleryWall{
      position:fixed;
      inset:0;
      z-index:1;
      pointer-events:none;
      background:
        radial-gradient(1100px 700px at 20% 15%, rgba(255,255,255,.12), rgba(255,255,255,0) 60%),
        radial-gradient(900px 600px at 70% 70%, rgba(255,255,255,.10), rgba(255,255,255,0) 55%);
    }

    .viewport{
      position:absolute;
      inset:0;
      overflow:hidden;
    }

    .row{
      position:absolute;
      top:50%;
      left:0;
      display:flex;
      align-items:center;
      transform: translate3d(0,-50%,0);
      will-change: transform;
      white-space: nowrap;
      padding: 0 60px;
      gap: 0; /* gap est géré dans les bands */
    }
    @media (max-width: 900px){
      .row{ padding: 0 28px; }
    }

    /* ✅ band = une boucle mesurable */
    .band{
      display:inline-flex;
      align-items:center;
      gap:42px; /* ✅ écart identique */
      flex: 0 0 auto;
    }

    /* ✅ gap entre les bandes (entre left/center/right) */
.row { column-gap: 42px; }           /* même valeur que .band gap */
@media (max-width: 900px){
  .row { column-gap: 28px; }
}

    @media (max-width: 900px){
      .band{ gap:28px; }
    }

    .piece{
      flex: 0 0 auto;
      height: min(62vh, 560px);
      width: var(--w, 360px);
      position: relative;
    }

    .piece::before{
      content:"";
      position:absolute;
      left:50%;
      top:-18%;
      width: 150%;
      height: 70%;
      transform: translateX(-50%);
      background: radial-gradient(closest-side, rgba(255,255,255,.22), rgba(255,255,255,0) 72%);
      opacity: .85;
      pointer-events:none;
      filter: blur(1px);
    }

    .frame{
  position:relative;
  width:100%;
  height:100%;
  background:#0b1520;
  border: 10px solid rgba(255,255,255,.10);
  outline: 1px solid rgba(255,255,255,.18);
  box-shadow: 0 24px 70px rgba(0,0,0,.45), inset 0 0 0 2px rgba(0,0,0,.35);
  overflow:hidden;
}

.art{ position:absolute; inset:0; }

.art img{
  width:100%;
  height:100%;
  object-fit: cover;   /* ✅ pas de bandes si ratio exact */
  display:block;
}

    .frame::after{
      content:"";
      position:absolute;
      inset:0;
      background:
        radial-gradient(120% 90% at 50% 35%, rgba(255,255,255,.10), rgba(0,0,0,.18) 70%),
        linear-gradient(180deg, rgba(0,0,0,.10), rgba(0,0,0,.18));
      opacity:.22;
      pointer-events:none;
    }

    .top, .bottom{position:relative;z-index:4;}
    .bottom{margin-top:auto;padding-bottom:18px;}

    @media (prefers-reduced-motion: reduce){
      .galleryWall{display:none;}
      body.home{overflow:auto;}
    }
  </style>
</head>

<body class="home">
  <div class="galleryWall" aria-hidden="true">
    <div class="viewport">
      <div class="row" id="row"></div>
    </div>
  </div>

  <div class="page">
    <div class="container">
      <header class="top">
        <div class="top__left">
          <a href="index.html" class="brand" aria-label="Accueil">ANNICK&nbsp;BOUVATTIER</a>
        </div>
        <nav class="top__nav" aria-label="Navigation principale">
          <a class="nav__link is-active" href="index.html">Accueil</a>
          <a class="nav__link" href="portfolio.html">Portfolio</a>
          <a class="nav__link" href="galeries.html">Galeries</a>
          <a class="nav__link" href="expositions.html">Expositions</a>
          <a class="nav__link" href="apropos.html">À propos</a>
          <a class="nav__link" href="presse.html">Presse</a>
          <a class="nav__link" href="contact.html">Contact</a>
        </nav>
      </header>

      <footer class="bottom">
        <div class="bottom__left">
          <a class="bottom__link" href="https://www.instagram.com/annick.bouvattier/" target="_blank" rel="noopener noreferrer">instagram</a>
          <a class="bottom__link" href="https://www.facebook.com/annick.bouvattier/" target="_blank" rel="noopener noreferrer">facebook</a>
          <a class="bottom__link" href="https://www.saatchiart.com/bouvattier" target="_blank" rel="noopener noreferrer">saatchi art</a>
        </div>
      </footer>
    </div>
  </div>
<script>
(() => {
  "use strict";

  const MANIFEST_URL = "images/manifest.json";
  const IMAGES_PREFIX = "images/";
  const BORDER_PX = 10;        // doit matcher .frame { border: 10px }
  const GAP_DESKTOP = 42;      // doit matcher ton CSS gap
  const GAP_MOBILE  = 28;

  const row = document.getElementById("row");
  if (!row) {
    console.error("[home-wall] #row introuvable");
    return;
  }

  // --- utils
  const prefersReducedMotion = window.matchMedia && window.matchMedia("(prefers-reduced-motion: reduce)").matches;

  function shuffle(arr){
    const a = arr.slice();
    for(let i=a.length-1;i>0;i--){
      const j = Math.floor(Math.random()*(i+1));
      [a[i],a[j]]=[a[j],a[i]];
    }
    return a;
  }

  async function loadManifestSafe(){
    try{
      const res = await fetch(MANIFEST_URL, { cache: "no-store" });
      if(!res.ok) throw new Error("HTTP " + res.status);
      const list = await res.json();
      if(!Array.isArray(list) || !list.length) throw new Error("manifest vide");
      return list;
    }catch(err){
      console.error("[home-wall] manifest KO, fallback:", err);
      // fallback minimal (mets 2-3 images sûres si tu veux)
      return [];
    }
  }

  function makePiece(src){
    const piece = document.createElement("div");
    piece.className = "piece";

    const frame = document.createElement("div");
    frame.className = "frame";

    const art = document.createElement("div");
    art.className = "art";

    const img = document.createElement("img");
    img.alt = "";
    img.loading = "eager";
    img.decoding = "async";
    img.src = IMAGES_PREFIX + src;

    art.appendChild(img);
    frame.appendChild(art);
    piece.appendChild(frame);

    img.addEventListener("error", () => {
      console.warn("[home-wall] image introuvable:", img.src);
      piece.remove();
    }, { once:true });

    return { piece, img };
  }

  function getPieceOuterHeightPx(examplePiece){
    // height: min(62vh, 560px) -> on lit le rendu réel
    const r = examplePiece.getBoundingClientRect();
    return Math.max(1, r.height);
  }

  function currentGap(){
    return window.innerWidth <= 900 ? GAP_MOBILE : GAP_DESKTOP;
  }

  function setExactWidthFromImage(piece, img){
    // hauteur utile = hauteur totale - 2*bordure
    const hOuter = getPieceOuterHeightPx(piece);
    const hInner = Math.max(1, hOuter - BORDER_PX*2);
    const ratio = img.naturalWidth / img.naturalHeight;

    const wInner = hInner * ratio;
    const wOuter = wInner + BORDER_PX*2;

    // mini seulement (sinon trop fin)
    const wFinal = Math.max(240, wOuter);

    piece.style.setProperty("--w", Math.round(wFinal) + "px");
  }

  function waitImageReady(img){
    // decode() est le plus fiable si dispo
    if (img.decode) {
      return img.decode().catch(() => {}); // decode peut rejeter si cross/erreur
    }
    return new Promise((resolve) => {
      if (img.complete) return resolve();
      img.addEventListener("load", resolve, { once:true });
      img.addEventListener("error", resolve, { once:true });
    });
  }

  function buildBands(pieces){
    // 3 bandes : left / center / right
    const bandL = document.createElement("div");
    const bandC = document.createElement("div");
    const bandR = document.createElement("div");
    bandL.className = "band";
    bandC.className = "band";
    bandR.className = "band";

    // répartir 1/3 - 1/3 - 1/3
    pieces.forEach((p, i) => {
      (i % 3 === 0 ? bandL : i % 3 === 1 ? bandC : bandR).appendChild(p);
    });

    row.innerHTML = "";
    row.appendChild(bandL);
    row.appendChild(bandC);
    row.appendChild(bandR);

    // clone pour boucle infinie (important: clone les 3 bandes)
    const cloneL = bandL.cloneNode(true);
    const cloneC = bandC.cloneNode(true);
    const cloneR = bandR.cloneNode(true);
    row.appendChild(cloneL);
    row.appendChild(cloneC);
    row.appendChild(cloneR);

    return { bandL, bandC, bandR };
  }

  function measureLoopWidth(){
    // largeur d’une “triple bande” = largeur des 3 premières bandes + 2*column-gap
    // Comme on a 6 bandes (3 originales + 3 clones), on mesure la moitié.
    const bands = row.querySelectorAll(".band");
    if (bands.length < 3) return 0;
    const w = bands[0].getBoundingClientRect().width
            + bands[1].getBoundingClientRect().width
            + bands[2].getBoundingClientRect().width
            + currentGap()*2;
    return w;
  }

  async function init(){
    if (prefersReducedMotion) return; // tu as déjà un fallback CSS

    const list = shuffle(await loadManifestSafe());

    if (!list.length) {
      console.error("[home-wall] manifest vide => rien à afficher");
      return;
    }

    // combien de pièces pour remplir la largeur + buffer
    const approxPerScreen = Math.ceil(window.innerWidth / 260) + 10;
    const count = Math.max(18, approxPerScreen * 2);

    // créer pièces
    const pieces = [];
    const imgs = [];
    for(let i=0;i<count;i++){
      const { piece, img } = makePiece(list[i % list.length]);
      pieces.push(piece);
      imgs.push(img);
    }

    // monter dans le DOM avant de mesurer hauteur réelle
    buildBands(pieces);

    // attendre que ça s’affiche une frame
    await new Promise(r => requestAnimationFrame(r));

    // attendre images prêtes + calculer largeur exacte
    await Promise.all(imgs.map(waitImageReady));
    imgs.forEach((img, idx) => {
      if (!img.naturalWidth || !img.naturalHeight) return;
      setExactWidthFromImage(pieces[idx], img);
    });

    // reflow
    await new Promise(r => requestAnimationFrame(r));

    // boucle
    let loopW = measureLoopWidth();
    if (!loopW) {
      console.error("[home-wall] loopWidth=0 (CSS/DOM)");
      return;
    }

    // départ : exactement hors écran à gauche
    let x = -loopW;
    const speed = 70; // px/s
    let last = performance.now();

    function tick(now){
      const dt = Math.min(0.05, (now - last)/1000);
      last = now;

      x += speed * dt;

      // quand on a “consommé” une boucle, on recale
      if (x >= 0) x -= loopW;

      row.style.transform = `translate3d(${x}px, -50%, 0)`;
      requestAnimationFrame(tick);
    }
    requestAnimationFrame(tick);

    // resize: recalcul propre
    window.addEventListener("resize", () => location.reload());
  }

  init().catch(err => console.error("[home-wall] fatal:", err));
})();
</script>

  
</body>
</html>
